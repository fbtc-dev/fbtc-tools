from ..config import BTC_RPC
from ..reqdata import RequestData
from ..verifier import Verifier

ConfirmMintRequestData = r"""
{"org_id": "3aM7ZZUr6ZKjtPekizBZx9S6MyswfchjXqaaq2LDwdbCYy5M8xf2TRwvP5horeVokzaSNr9wFEgqjuyBwRsKi8vywSjX3yZxJwkvpcemsjfGTLoCRjB3WugscYCrBTntDLGKvmqpg", "transaction_type": "Contract", "wallet_name": "FBTC Minter", "chain": "Ethereum Sepolia Testnet", "initiator": "API", "request_id": "d556f551bf13afe29ac4fae31404f7791d5b2048abf96b828eee5b55d1b15f82:0xaa36a7", "xxxx_id": "20240524105457000311471000002081", "created_time": 1716519297, "from": "0x772101dde0b084e6354a6f5bb8ed57b8fa08e7f2", "to": "0x9cb74e884580131f6d965A0c66c6ed29D3AA3AfC", "protocol": {"name": "", "url": ""}, "value": "0 SETH", "fee": {"gas_fee": {"fee": "0.000169070860643286", "gas_price": "0.000000001501490743", "gas_limit": "112602"}, "priority_fee": null, "max_fee": null, "fee_coin": "SETH", "gas_unit": "SETH"}, "message": "", "estimated_fee": "0.000169070860643286 SETH\uff081.501490743E-9 SETH * 112602\uff09", "note": "{\n    \"bridge_tx_info\": {\n        \"chain_id\": \"0xaa36a7\",\n        \"bridge_request_hash\": \"0xd556f551bf13afe29ac4fae31404f7791d5b2048abf96b828eee5b55d1b15f82\",\n        \"btc_deposit_tx_id\": \"81706a7c740eb0fe08965e9ac1374e56a397b1ca7a6611574060dc045dba65c4\",\n        \"add_mint_request_tx_id\": \"0x9c365e09d07478847e8565595f81bb24bec3ba6a58518c0acabaaa70d3e49524\"\n    },\n    \"water_mask\": {\n        \"current\": \"0\",\n        \"pending\": \"0\"\n    }\n}", "from_address_label": "", "to_address_label": "", "customs": [{"calldata": ["2bf90baad556f551bf13afe29ac4fae31404f7791d5b2048abf96b828eee5b55d1b15f82"]}, {"name": ["confirmMintRequest"]}, {"function": ["confirmMintRequest(bytes32)"]}, {"params.hash": ["d556f551bf13afe29ac4fae31404f7791d5b2048abf96b828eee5b55d1b15f82"]}], "export_json": true, "raw_data": {"xxxx_id": "20240524105457000311471000002081", "api_request_id": "d556f551bf13afe29ac4fae31404f7791d5b2048abf96b828eee5b55d1b15f82:0xaa36a7", "transaction_type": 303, "operation": 200, "coin": "SETH", "from_address": "0x772101dde0b084e6354a6f5bb8ed57b8fa08e7f2", "amount": "0", "to_address": "0x9cb74e884580131f6d965A0c66c6ed29D3AA3AfC", "to_address_details": "", "fee": 0, "gas_price": 1, "gas_limit": 0, "api_key": "026c035f5406daa191e836e1dab16e63c09434654db2e4e06e57abab100f31b2f0", "spender": "", "operator": "", "extra_parameters": "{\"calldata\":\"2bf90baad556f551bf13afe29ac4fae31404f7791d5b2048abf96b828eee5b55d1b15f82\"}", "note": "{\n    \"bridge_tx_info\": {\n        \"chain_id\": \"0xaa36a7\",\n        \"bridge_request_hash\": \"0xd556f551bf13afe29ac4fae31404f7791d5b2048abf96b828eee5b55d1b15f82\",\n        \"btc_deposit_tx_id\": \"81706a7c740eb0fe08965e9ac1374e56a397b1ca7a6611574060dc045dba65c4\",\n        \"add_mint_request_tx_id\": \"0x9c365e09d07478847e8565595f81bb24bec3ba6a58518c0acabaaa70d3e49524\"\n    },\n    \"water_mask\": {\n        \"current\": \"0\",\n        \"pending\": \"0\"\n    }\n}", "replace_xxxx_id": "", "decimal": 18, "gas_station_child_id": "", "custody_wallet_name": "FBTC Minter"}, "template_version": "1.0.1", "language": "en", "audit_role": "approver", "timestamp": 1716519300, "title": "Approver Approval"}
"""

ConfirmBurnRequestData = r"""
{"org_id": "3aM7ZZUr6ZKjtPekizBZx9S6MyswfchjXqaaq2LDwdbCYy5M8xf2TRwvP5horeVokzaSNr9wFEgqjuyBwRsKi8vywSjX3yZxJwkvpcemsjfGTLoCRjB3WugscYCrBTntDLGKvmqpg", "transaction_type": "Contract", "wallet_name": "FBTC Burner", "chain": "Ethereum Sepolia Testnet", "initiator": "API", "request_id": "ef11d167f259242bc9beb712d6217377d0fdc217e72b50beb23097b22dd41418:0xaa36a7:3", "xxxx_id": "20240524134952000322615000005046", "created_time": 1716529792, "from": "0x2f8125ed803e2928f4eed2e8cf68aee349fa7219", "to": "0x9cb74e884580131f6d965A0c66c6ed29D3AA3AfC", "protocol": {"name": "", "url": ""}, "value": "0 SETH", "fee": {"gas_fee": {"fee": "0.000181863499864851", "gas_price": "0.000000001509879699", "gas_limit": "120449"}, "priority_fee": null, "max_fee": null, "fee_coin": "SETH", "gas_unit": "SETH"}, "message": "", "estimated_fee": "0.000181863499864851 SETH\uff081.509879699E-9 SETH * 120449\uff09", "note": "{\n    \"bridge_tx_info\": {\n        \"chain_id\": \"0xaa36a7\",\n        \"bridge_request_hash\": \"0xef11d167f259242bc9beb712d6217377d0fdc217e72b50beb23097b22dd41418\",\n        \"btc_withdraw_tx_id\": \"fa0a56b1e23b8d290c856e918f8179a3f37d4fc1f13ead5ec0c3c0b5e39d08d9\",\n        \"add_burn_request_tx_id\": \"0x3f13840aad1b89326de99b0cadcac92d315d89112f3e358facbf9eebb483892a\"\n    },\n    \"water_mask\": {\n        \"current\": \"0\",\n        \"pending\": \"0\"\n    }\n}", "from_address_label": "", "to_address_label": "", "customs": [{"calldata": ["2313e70eef11d167f259242bc9beb712d6217377d0fdc217e72b50beb23097b22dd41418fa0a56b1e23b8d290c856e918f8179a3f37d4fc1f13ead5ec0c3c0b5e39d08d90000000000000000000000000000000000000000000000000000000000000000"]}, {"name": ["confirmBurnRequest"]}, {"function": ["confirmBurnRequest(bytes32,bytes32,uint256)"]}, {"params.hash": ["ef11d167f259242bc9beb712d6217377d0fdc217e72b50beb23097b22dd41418"]}, {"params.withdrawalTxid": ["fa0a56b1e23b8d290c856e918f8179a3f37d4fc1f13ead5ec0c3c0b5e39d08d9"]}, {"params.outputIndex": ["0"]}], "export_json": true, "raw_data": {"xxxx_id": "20240524134952000322615000005046", "api_request_id": "ef11d167f259242bc9beb712d6217377d0fdc217e72b50beb23097b22dd41418:0xaa36a7:3", "transaction_type": 303, "operation": 200, "coin": "SETH", "from_address": "0x2f8125ed803e2928f4eed2e8cf68aee349fa7219", "amount": "0", "to_address": "0x9cb74e884580131f6d965A0c66c6ed29D3AA3AfC", "to_address_details": "", "fee": 0, "gas_price": 1, "gas_limit": 0, "api_key": "028a0b1ebe9369e41d4dbaf4ee7b79088eec91c708c9270638fbc6da72e5b2a253", "spender": "", "operator": "", "extra_parameters": "{\"calldata\":\"2313e70eef11d167f259242bc9beb712d6217377d0fdc217e72b50beb23097b22dd41418fa0a56b1e23b8d290c856e918f8179a3f37d4fc1f13ead5ec0c3c0b5e39d08d90000000000000000000000000000000000000000000000000000000000000000\"}", "note": "{\n    \"bridge_tx_info\": {\n        \"chain_id\": \"0xaa36a7\",\n        \"bridge_request_hash\": \"0xef11d167f259242bc9beb712d6217377d0fdc217e72b50beb23097b22dd41418\",\n        \"btc_withdraw_tx_id\": \"fa0a56b1e23b8d290c856e918f8179a3f37d4fc1f13ead5ec0c3c0b5e39d08d9\",\n        \"add_burn_request_tx_id\": \"0x3f13840aad1b89326de99b0cadcac92d315d89112f3e358facbf9eebb483892a\"\n    },\n    \"water_mask\": {\n        \"current\": \"0\",\n        \"pending\": \"0\"\n    }\n}", "replace_xxxx_id": "", "decimal": 18, "gas_station_child_id": "", "custody_wallet_name": "FBTC Burner"}, "template_version": "1.0.1", "language": "en", "audit_role": "approver", "timestamp": 1716529802, "title": "Approver Approval"}
"""

BTCWithdrawalData = r"""
{"org_id": "3aM7ZZUr6ZKjtPekizBZx9S6MyswfchjXqaaq2LDwdbCYy5M8xf2TRwvP5horeVokzaSNr9wFEgqjuyBwRsKi8vywSjX3yZxJwkvpcemsjfGTLoCRjB3WugscYCrBTntDLGKvmqpg", "transaction_type": "Withdraw", "wallet_name": "BTC Pool", "chain": "Bitcoin Testnet3", "initiator": "API", "request_id": "ef11d167f259242bc9beb712d6217377d0fdc217e72b50beb23097b22dd41418:0xaa36a7", "xxxx_id": "20240524114600000362026000004809", "created_time": 1716522360, "from": "BTC Pool", "to": "tb1q535vz3mn0gftwcmwmaqtx9h8fdczazwrfjw3tz", "protocol": {"name": "", "url": ""}, "value": "0.05 XTN", "fee": {"gas_fee": {"fee": "0.00042897", "gas_price": "181", "gas_limit": "237"}, "priority_fee": null, "max_fee": null, "fee_coin": "XTN", "gas_unit": "SAT/BYTE"}, "message": "", "estimated_fee": "0.00042897 XTN\uff08181.00000000 SAT/BYTE * 237\uff09", "note": "{\n    \"bridge_tx_info\": {\n        \"chain_id\": \"0xaa36a7\",\n        \"bridge_request_hash\": \"0xef11d167f259242bc9beb712d6217377d0fdc217e72b50beb23097b22dd41418\",\n        \"add_burn_request_tx_id\": \"0x3f13840aad1b89326de99b0cadcac92d315d89112f3e358facbf9eebb483892a\"\n    },\n    \"water_mask\": {\n        \"current\": \"0\",\n        \"pending\": \"0\"\n    }\n}", "from_address_label": "", "to_address_label": "", "customs": [], "export_json": true, "raw_data": {"xxxx_id": "20240524114600000362026000004809", "api_request_id": "ef11d167f259242bc9beb712d6217377d0fdc217e72b50beb23097b22dd41418:0xaa36a7", "transaction_type": 102, "operation": 100, "coin": "XTN", "from_address": "", "amount": "5000000", "to_address": "tb1q535vz3mn0gftwcmwmaqtx9h8fdczazwrfjw3tz", "to_address_details": "", "fee": 0, "gas_price": 1, "gas_limit": 0, "api_key": "0231416e283748a467d52809294d546a43b83aef109522c30ddcf1bb37ccc96de7", "spender": "", "operator": "", "extra_parameters": "{}", "note": "{\n    \"bridge_tx_info\": {\n        \"chain_id\": \"0xaa36a7\",\n        \"bridge_request_hash\": \"0xef11d167f259242bc9beb712d6217377d0fdc217e72b50beb23097b22dd41418\",\n        \"add_burn_request_tx_id\": \"0x3f13840aad1b89326de99b0cadcac92d315d89112f3e358facbf9eebb483892a\"\n    },\n    \"water_mask\": {\n        \"current\": \"0\",\n        \"pending\": \"0\"\n    }\n}", "replace_xxxx_id": "", "decimal": 8, "gas_station_child_id": "", "custody_wallet_name": "BTC Pool"}, "template_version": "1.0.1", "language": "en", "audit_role": "approver", "timestamp": 1716522364, "title": "Approver Approval"}
"""

ConfirmCrosschainData = r"""
{"org_id": "3aM7ZZUr6ZKjtPekizBZx9S6MyswfchjXqaaq2LDwdbCYy5M8xf2TRwvP5horeVokzaSNr9wFEgqjuyBwRsKi8vywSjX3yZxJwkvpcemsjfGTLoCRjB3WugscYCrBTntDLGKvmqpg", "transaction_type": "Contract", "wallet_name": "Cross-chain Relayer", "chain": "Layer2 Mantle Sepolia", "initiator": "API", "request_id": "e6c9f9ea989e5aba5ed6e732d2c9602e3bc93edf0bffe65cd468d347a7e9b317:0xaa36a7", "xxx_id": "20240617170141000353768000003797", "created_time": 1718614901, "from": "0xdf15464be388af6566c880b9db1bb7167e2fb1ba", "to": "0x0Cb8F643D2a622943129870338473d4571be68BD", "protocol": {"name": "", "url": ""}, "value": "0 MANTLE Sepolia", "fee": {"gas_fee": {"fee": "0.08075403304", "gas_price": "0.00000000004", "gas_limit": "2018850826"}, "priority_fee": null, "max_fee": null, "fee_coin": "MANTLE Sepolia", "gas_unit": "MANTLE Sepolia"}, "message": "", "estimated_fee": "0.08075403304 MANTLE Sepolia\uff080.00000000004 MANTLE Sepolia * 2018850826\uff09", "note": "{\n    \"bridge_tx_info\": {\n        \"chain_id\": \"0xaa36a7\",\n        \"bridge_request_hash\": \"0xe6c9f9ea989e5aba5ed6e732d2c9602e3bc93edf0bffe65cd468d347a7e9b317\",\n        \"add_cross_chain_request_tx_id\": \"0xb60fd82d25910bb078bba7c3a9934fd785118f24aeba2f170df28789f0d0ae8f\"\n    }\n}", "from_address_label": "", "to_address_label": "", "customs": [{"calldata": ["1d710bd1000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000aa36a70000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000138b0000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000002e630000000000000000000000000000000000000000000000000000000000000271000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000f9d6b8afc1f64d6eb083c1291bad48c5785156b0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000254b00cc56eee46558bd81d46bb7348393dfbe6a0000000000000000000000000000000000000000000000000000000000000020e6c9f9ea989e5aba5ed6e732d2c9602e3bc93edf0bffe65cd468d347a7e9b317"]}, {"name": ["confirmCrosschainRequest"]}, {"function": ["confirmCrosschainRequest((uint8,uint8,uint128,bytes32,bytes,bytes32,bytes,uint256,uint256,bytes))"]}, {"params.req.op": ["4"]}, {"params.req.status": ["0"]}, {"params.req.nonce": ["30"]}, {"params.req.srcChain": ["0000000000000000000000000000000000000000000000000000000000aa36a7"]}, {"params.req.srcAddress": ["0000000000000000000000000f9d6b8afc1f64d6eb083c1291bad48c5785156b"]}, {"params.req.dstChain": ["000000000000000000000000000000000000000000000000000000000000138b"]}, {"params.req.dstAddress": ["000000000000000000000000254b00cc56eee46558bd81d46bb7348393dfbe6a"]}, {"params.req.amount": ["190000"]}, {"params.req.fee": ["10000"]}, {"params.req.extra": ["e6c9f9ea989e5aba5ed6e732d2c9602e3bc93edf0bffe65cd468d347a7e9b317"]}], "export_json": true, "raw_data": {"xxx_id": "20240617170141000353768000003797", "api_request_id": "e6c9f9ea989e5aba5ed6e732d2c9602e3bc93edf0bffe65cd468d347a7e9b317:0xaa36a7", "transaction_type": 303, "operation": 200, "coin": "SMNT_MNT", "from_address": "0xdf15464be388af6566c880b9db1bb7167e2fb1ba", "amount": "0", "to_address": "0x0Cb8F643D2a622943129870338473d4571be68BD", "to_address_details": "", "fee": 0, "gas_price": 1, "gas_limit": 0, "api_key": "02a160b92910917568a91544232bf6cba32d8ba1572c919c01d90fca3dc9a0bc79", "spender": "", "operator": "", "extra_parameters": "{\"calldata\":\"1d710bd1000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000aa36a70000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000138b0000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000002e630000000000000000000000000000000000000000000000000000000000000271000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000f9d6b8afc1f64d6eb083c1291bad48c5785156b0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000254b00cc56eee46558bd81d46bb7348393dfbe6a0000000000000000000000000000000000000000000000000000000000000020e6c9f9ea989e5aba5ed6e732d2c9602e3bc93edf0bffe65cd468d347a7e9b317\"}", "note": "{\n    \"bridge_tx_info\": {\n        \"chain_id\": \"0xaa36a7\",\n        \"bridge_request_hash\": \"0xe6c9f9ea989e5aba5ed6e732d2c9602e3bc93edf0bffe65cd468d347a7e9b317\",\n        \"add_cross_chain_request_tx_id\": \"0xb60fd82d25910bb078bba7c3a9934fd785118f24aeba2f170df28789f0d0ae8f\"\n    }\n}", "replace_xxx_id": "", "decimal": 18, "gas_station_child_id": "", "custody_wallet_name": "Cross-chain Relayer"}, "template_version": "1.0.1", "language": "zh", "audit_role": "approver", "timestamp": 1718614904, "title": "\u5ba1\u6838\u5458\u5ba1\u6838"}"""


def test_verify_mint():
    v = Verifier(
        BTC_RPC["xtn"], bridge_addr="0x97b61375C59D81be63c32662316F5d6A3Be4D43f"
    )

    v.verify_request(RequestData(ConfirmMintRequestData))


def test_verify_withdraw():
    v = Verifier(
        BTC_RPC["xtn"], bridge_addr="0x97b61375C59D81be63c32662316F5d6A3Be4D43f"
    )

    v.verify_request(RequestData(BTCWithdrawalData))


def test_verify_crosschain():
    v = Verifier(
        BTC_RPC["xtn"], bridge_addr="0x5c6b3B3A6637b83323aB576F61Df4a87527968EF"
    )
    v.verify_request(RequestData(ConfirmCrosschainData))
